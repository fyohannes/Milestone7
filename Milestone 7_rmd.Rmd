---
title: "Milestone7"
author: "Feven Yohannes"
date: "April 17, 2020"
output: html_document
---

```{r setup, include=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(readr)
library(styler)

# Styling for comments

library(dplyr)
library(lmtest)
library(gridExtra)

# Need this package to package for my posterior predicitive distribution graphs in my extension -- trial 1

library(huxtable)

# Need this package for my posterior predictive distribution graphs 

library(tinytex)

# Need this to run coeftest

library(sandwich)

# Need this to run vcovHc

library(tidybayes)
library(bayesplot)
library(ggplot2)

# Need this to make my graphic for my extension 

library(rstanarm)
library(cowplot)

# Need this for my graphics in my extension

library(stargazer)
library(tidyverse)

# Reading in the data 

budget <- read_csv("dataverse_files/replication_file_jop/data/budget_results.csv", col_types = cols(
  .default = col_double(),
  kab.x = col_character(),
  kab.y = col_character()
))

constituency_data  <- read_csv("dataverse_files/replication_file_jop/data/pub_opinion_results.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))

candidate_data  <- read_csv("dataverse_files/replication_file_jop/data/candidate_2019_data.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))

center_data  <- read_csv("dataverse_files/replication_file_jop/data/center_data.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))

gender_data  <- read_csv("dataverse_files/replication_file_jop/data/dapil_gender_composition.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))

election_data  <- read_csv("dataverse_files/replication_file_jop/data/election_characteristics_balance.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))

gender_estimation_data  <- read_csv("dataverse_files/replication_file_jop/data/estimation_sample_dapils_w_gender.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))
  
laws_data  <- read_csv("dataverse_files/replication_file_jop/data/laws_dprd_2009.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))

public_opinion_individual_data  <- read_csv("dataverse_files/replication_file_jop/data/pub_opinion_results_individual.csv",
                           col_types = cols(
  .default = col_double(),
  dapil = col_character()
                           ))
```

#Extension: 

```{r,extension for table1,results="asis", warning=FALSE,message=FALSE}

# I set my seed all the numbers of my results stay the same

set.seed(9)

# This is filtering so we only look at observations where female constitutents win by a margin of one percent or less


constituency_data <- constituency_data[abs(constituency_data$win_margin) < 0.01,]


# Instead of running the regression by using lm, I will use stan_lm
# Adding refresh=0 so it doesn't run multiple times
# Using prior=NULL because we have no prior since we are transforming te orginial lm regressions into a Bayesian model

mod_fem1_new <- stan_lm(v744a_f2012 ~ woman_win, data = constituency_data, prior= NULL, refresh=0)
mod_fem2_new <- stan_lm(v744b_f2012 ~ woman_win, data = constituency_data, prior= NULL,refresh=0)
mod_fem3_new <- stan_lm(v744c_f2012 ~ woman_win, data = constituency_data, prior= NULL,refresh=0)
mod_fem4_new <- stan_lm(v744d_f2012 ~ woman_win, data = constituency_data, prior= NULL,refresh=0)
mod_fem5_new <- stan_lm(v744e_f2012 ~ woman_win, data = constituency_data,prior= NULL,refresh=0)

# This added an index of the prior information onto the table

mod_fem7_new <- stan_lm(add_index_f2012 ~ woman_win, data = constituency_data, prior= NULL,refresh=0)

#Nobs computes the number of non-missing observations

observations_new <- c(nobs(mod_fem1_new),nobs(mod_fem2_new),nobs(mod_fem3_new),nobs(mod_fem4_new),nobs(mod_fem5_new),nobs(mod_fem7_new))

#Coefests is an inference for estimated coefficents on the models
#I need different names for the coeftests and the regressions bc my graphics will just be looking at bayesian regressions

mod_fem1_new_coef <- coeftest(mod_fem1_new)
mod_fem2_new_coef <- coeftest(mod_fem2_new)
mod_fem3_new_coef <- coeftest(mod_fem3_new)
mod_fem4_new_coef<- coeftest(mod_fem4_new)
mod_fem5_new_coef <- coeftest(mod_fem5_new)
mod_fem7_new_coef <- coeftest(mod_fem7_new)


#Made the models with their respective coefficents into a table 
#The numbers in the parantheses is the standard error. 
#Why do I have 156 observations?
#What do all of my numbers mean?
#How can I set a subcaption?


table_new <- huxreg('Goes out'= mod_fem1_new, 'Neglects Children'= mod_fem2_new, 'Argues'= mod_fem3_new, 'Refuses sex'= mod_fem4_new, 'Burns food'= mod_fem5_new, 'Index'=mod_fem7_new)

# show pvalue >>>> with bayesian you cant get a specfic pvalue >>> bayesian pvalue?
# not signifant?

# Adding a tittle 

table_new <- table_new %>%
  set_caption('Linear regressions of Female Incumbency on IPV attitudes for Female Constitutents') 

# Printing my table

table_new


#ppcheck >>> shows difference between the  model data... how well the bayesian regression fits with the data that is provided 

#dark line is the data, light line is the bayesian model

#The code found for the posterior predictive check of model 1 is similiar to the next 5 models
#I used the pp_check function to make the posterior predicitve graphic
#I used the theme function to change the arrnagement of my x axis lables 
#I decreased the size of the legend 

# This graph just looks at the index showing overall IPV attitude changes
# Posterior Predicitve Check on the index because that shows how good the overall model fit is

#What should be my caption?

model7_check <- pp_check(mod_fem7_new,"dens_overlay") +  theme(axis.text.x = element_text(size = 9, angle = 90, vjust = 0.5)) +
  labs(title= "Posterior Predicitve Checking for Female Constituent Results", subtitle = "Examining the regression that predicts the change in overall female attitudes on Intimate Partner Violence", caption= "The above graph depicts how well the Bayesian model fits the index model. This index model is an aggregation of 5 regressions that predict change in IPV attutides for female constituents with their respecitive dependent variables. Overall the graph shows that this model seems to be a good fit for the model that predicts change in IPV attitudes for female constituents.") +
  theme(legend.title = element_text(size = 5), 
               legend.text = element_text(size = 7))


model7_check

#Arranging all of the graphs on one page


#graphic1 <- plot_grid(model1_check,model2_check,model3_check,model4_check,model5_check,model7_check,label_size = 12) + labs(title="Posterior Predictive Checking")

#graphic1 <- grid.arrange(model1_check,model2_check,model3_check,model4_check,model5_check,model7_check, ncol= 3, top="Posterior Predictive Checking for Female Constitutent Results")

#I wanted three columns and one main title 
#ppcheck?
#observations??

```


```{r,extension for table2,results="asis",warning=FALSE}

set.seed(9)

# These lines of code do the same thing that the previous table did, however, rather than predicting female respondent results, it predicts male respondent results. 

# Instead of running the regression by using lm, I will use stan_lm
# Adding refresh=0 so it doesn't run multiple times
# Using prior=NULL because we have no prior since we are transforming te orginial lm regressions into a Bayesian model

mod_mal1_new <- stan_lm(v744a_m2012 ~ woman_win, prior= NULL, data = constituency_data,refresh=0)
mod_mal2_new <- stan_lm(v744b_m2012 ~ woman_win, prior= NULL, data = constituency_data,refresh=0)
mod_mal3_new <- stan_lm(v744c_m2012 ~ woman_win, prior= NULL, data = constituency_data,refresh=0)
mod_mal4_new <- stan_lm(v744d_m2012 ~ woman_win, prior= NULL, data = constituency_data,refresh=0)
mod_mal5_new <- stan_lm(v744e_m2012 ~ woman_win,  prior= NULL,data = constituency_data,refresh=0)
mod_mal7_new <- stan_lm(add_index_m2012 ~ woman_win,  prior= NULL,data = constituency_data,refresh=0)

# Named it observations2_new, so I didn't get confused with the other names

observations2_new <- c(nobs(mod_mal1_new),nobs(mod_mal2_new),nobs(mod_mal3_new),nobs(mod_mal4_new),nobs(mod_mal5_new),nobs(mod_mal7_new))

# The code below takes the coeftest of the models. I got rid of the original code that included covariance bc the covariance isn't present when running stan_lm, althogh it is in the original code when we ran stan_lm

mod_mal1_coef <- coeftest(mod_mal1_new)
mod_mal2_coef <- coeftest(mod_mal2_new)
mod_mal3_coef <- coeftest(mod_mal3_new)
mod_mal4_coef <- coeftest(mod_mal4_new)
mod_mal5_coef <- coeftest(mod_mal5_new)
mod_mal7_coef <- coeftest(mod_mal7_new)

table_new_male <- list(mod_mal1_new, mod_mal2_new, mod_mal3_new, mod_mal4_new, mod_mal5_new, mod_mal7_new)

# Making my table for male constiutents 

table_new_male <- huxreg('Goes out'= mod_mal1_new, 'Neglects Children'= mod_mal2_new, 'Argues'= mod_mal3_new, 'Refuses sex'= mod_mal4_new, 'Burns food'= mod_mal5_new, 'Index'=mod_mal7_new)


table_new_male <- table_new_male %>%
  set_caption('Linear regressions of Female Incumbency on IPV attitudes for Male Constituents') 

# Printing my table 

table_new_male


# This graph just looks at the index showing overall IPV attitude changes for males

model7_check_male <- pp_check(mod_mal7_new,"dens_overlay") +
  labs(title="Posterior Predicitve Cehcking for male Constituent Results",subtitle = "Examining the regression that predicts the change in overall male attitudes on Intimate Partner Violence", caption ="The above graph depicts how well the Bayesian model fits the index model. This index model is an aggregation of 5 regressions that predict change in IPV attutides for male constituents with their respecitive dependent variables. Overall the graph shows that this model is not a good fit for the model that predicts change in IPV attitudes for male constituents. One can see that the model that predicts female constituents is a much better fit, perhaps suggesting that the addition of female legislators has a larger effect on female constituents than male constituents.") + theme(axis.text.x = element_text(size = 9, angle = 90, vjust = 0.5)) + theme(legend.title = element_text(size = 5), 
               legend.text = element_text(size = 7))

# Printing the table for the index only

model7_check_male

#graphic2 <- grid.arrange(model1_check_male,model2_check_male,model3_check_male,model4_check_male,model5_check_male,model7_check_male,ncol= 3, top="Posterior Predictive Checking for Male Constitutent Results ")

```

For my extension, I focused on re-creating the original regressions through a Bayesian model rather than a standard linear regression. A Bayesian regression, unlike the standard linear regression that reflects Frequentist thought, examines the predicitive probability and sampling of posterior probability distribution. This distribution intergrates priors into the modeling and thus change the distribution of our posterior probaility. I used this Bayesian method and ran two models from the main results of the paper. The first was the model that predicted female attitude changes on IPV public opinion. The second was a similiar model that predicted male attitudes on IPV public opinion. These new models used the Bayesian inference for linear modeling and thus included regularizing piors on the model parameters. 

First I modeled the two regressions through the Bayesian function stan_lm rather than a standard lm function. I had kept the dependent variables the same because I wanted to compare the regressions with the two different functions without changing much else in the model. The stan_lm function includes an argument that specifies the priors of the model so it's included in the regression. In my regression I set priors to NULL because there were no specific priors from the data available. While the model did not include specific priors, the regressions created still ......

Overall, I attempted to examine any discrepencies between the results of these models with the original models found in the paper. I evaluated how well this model fit the data by comparing the coefficent estimates with the coefficent estimates in the original models used in the paper and through a posterior predicitve check. 

In my first model, the model that predicited the change in female IPV opinions, the results between the coefficents of the standard linear model was consistent with the  Bayesisan model. The coefficents for female incumbency, which measured the change in public opinion for regions where a female candidate won by one percentage point. The results essentially rendered the same output for each dependent variable after accounting for some minor discrpencies. For example we see that the coefficents for Female Incumbency on the second dependent variable in the orginal paper is -.0.058. In the new model we see the Female Incumbency coefficent at around -0.0366. Most imporatntly the coefficent estimates for the index (the aggregation of all 5 models with their respecitive dependent variables) were also consistent. In the original paper, the constant was 0.835 and the coefficent for Female Incumbency was -0.203. In my regression model the index showed a constant of 0.832 and a Female Incumbency coefficent of -0.197. Thus, while the numbers are not identical, the values are not far from each other and thus show consistency between the two types of models.

Similiar to the first model that predicted the change in IPV opions, the second model predicted the change in IPV opinions for male constitutents. I also ran a Bayesian regression on the second model and generally found the estimates for the the coefficents of female incumbency on each dependent variable to be consistent with the original paper. Looking at the index specifically, we see that the esitmate for the consant and Female Incumbency coefficent is O.406 and -0.133 respecitvely in the original paper. In my regression I found the consant to be 0.401 and the coefficent for Female incumbency to be -0.124. Thus, these the two ouputs are quite similiar and consistent. Overall, the two Bayesian models seemed to be consistent with the results of the standard linear models. This tells us that ....

In addition to the Bayesian models that I created, I also ran a posterior predictive check on the Bayesian regressions for both the models that predicted the change in female and male attitudes. The graphics that I have shown below represent these posterior predictive checkings, a method that simulates replicated data and compares it to the orginal data. Each graph compares the simulated data which is donoted as yrep and has a light blue color, with the orginal data which is donoted as y and has a dark blue color. When running the posterior predictive check on the regressions that predicted female public opinion, we can see that both fitted lines are quite similiar. This suggests that the model that we have is a pretty good fit for our data. However, when running the posterior predicitve check on regressions that predicted male public opinion, we can see that that fitted lines have more variance and at times don't follow the same pattern. This is specifally true for regressions that predicted male opinions from the third, fourth, and fifth dependent variable. This outcome is in line with the results of the data, as the paper stated that the regressions for males showed less signifcant results, thus hinting that the model for male constituents are not a great fit for the data. 

# Appendix
```{r,appendix,results="asis",message=FALSE}

#Replication code for table 1

#These fitted lines model the relationship between female incumbency and public opinions on 5 questions. These five questions incude 1)Is it okay to beat one's wife if she goes out?  2)Is it okay to beat one's wife if she neglects the kids?  3)Is it okay to beat one's wife if she argues? 4)Is it okay to beat one's wife if she refuses food ? 5) Is it okay to beat one's wife if she burns food?

mod_fem1 <- lm(v744a_f2012 ~ woman_win, data = constituency_data)
mod_fem2 <- lm(v744b_f2012 ~ woman_win, data = constituency_data)
mod_fem3 <- lm(v744c_f2012 ~ woman_win, data = constituency_data)
mod_fem4 <- lm(v744d_f2012 ~ woman_win, data = constituency_data)
mod_fem5 <- lm(v744e_f2012 ~ woman_win, data = constituency_data)

#This added an index of the prior information onto the table

mod_fem7 <- lm(add_index_f2012 ~ woman_win, data = constituency_data)

#Nobs computes the number of non-missing observations

observations <- c(nobs(mod_fem1),nobs(mod_fem2),nobs(mod_fem3),nobs(mod_fem4),nobs(mod_fem5),nobs(mod_fem7))

#Coefests is an inference for estimated coefficents on the models

mod_fem1 <- coeftest(mod_fem1, vcov=vcovHC(mod_fem1,type="HC0"))
mod_fem2 <- coeftest(mod_fem2, vcov=vcovHC(mod_fem2,type="HC0"))
mod_fem3 <- coeftest(mod_fem3, vcov=vcovHC(mod_fem3,type="HC0"))
mod_fem4 <- coeftest(mod_fem4, vcov=vcovHC(mod_fem4,type="HC0"))
mod_fem5 <- coeftest(mod_fem5, vcov=vcovHC(mod_fem5,type="HC0"))
mod_fem7 <- coeftest(mod_fem7, vcov=vcovHC(mod_fem7,type="HC0"))

#Made the models with their respective coefficents into a table 

table <- list(mod_fem1, mod_fem2, mod_fem3, mod_fem4, mod_fem5, mod_fem7)

note_text <- paste("Beta coefficients from OLS regression. Standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one's wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

#Used stargazer to make the table

table = stargazer(table,
                  title = "Effect of Female Incumbency on Female Attitudes Towards IPV", 
                  label = 'tab:table_female',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", observations),
                                   c('Bandwidth', rep(c('1\\%'), 6))),
                  covariate.labels = c("Female Incumbency"),
                  star.cutoffs = c(0.05, 0.01),
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l')


#Reading in table 2 

#These lines of code do the same thing that the previous table did, however, rather than predicting female respondent results, it predicts male respondent results. 

mod_mal1 <- lm(v744a_m2012 ~ woman_win, data = constituency_data)
mod_mal2 <- lm(v744b_m2012 ~ woman_win, data = constituency_data)
mod_mal3 <- lm(v744c_m2012 ~ woman_win, data = constituency_data)
mod_mal4 <- lm(v744d_m2012 ~ woman_win, data = constituency_data)
mod_mal5 <- lm(v744e_m2012 ~ woman_win, data = constituency_data)
mod_mal7 <- lm(add_index_m2012 ~ woman_win, data = constituency_data)

observations <- c(nobs(mod_mal1),nobs(mod_mal2),nobs(mod_mal3),nobs(mod_mal4),nobs(mod_mal5),nobs(mod_mal7))

mod_mal1 <- coeftest(mod_mal1, vcov=vcovHC(mod_mal1,type="HC0"))
mod_mal2 <- coeftest(mod_mal2, vcov=vcovHC(mod_mal2,type="HC0"))
mod_mal3 <- coeftest(mod_mal3, vcov=vcovHC(mod_mal3,type="HC0"))
mod_mal4 <- coeftest(mod_mal4, vcov=vcovHC(mod_mal4,type="HC0"))
mod_mal5 <- coeftest(mod_mal5, vcov=vcovHC(mod_mal5,type="HC0"))
mod_mal7 <- coeftest(mod_mal7, vcov=vcovHC(mod_mal7,type="HC0"))

table <- list(mod_mal1, mod_mal2, mod_mal3, mod_mal4, mod_mal5, mod_mal7)

note_text <- paste("Beta coefficients from OLS regression. Standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one’s wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

table2 = stargazer(table,
                  title = "Effect of Female Incumbency on Male Attitudes Towards IPV",
                  label = 'tab:table_male',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", observations),
                                   c('Bandwidth', rep(c('1\\%'), 6))),
                  covariate.labels = c("Female Incumbency"),
                  star.cutoffs = c(0.05, 0.01),
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l')

#Reading in table 3

#Another table showing female respondent results 
#This table runs the hypothetical placebo effect for both males and females of the models prior

#These models are specific to females

mod2007_fem1 <- lm(v744a_f2007 ~ woman_win, data = constituency_data)
mod2007_fem2 <- lm(v744b_f2007 ~ woman_win, data = constituency_data)
mod2007_fem3 <- lm(v744c_f2007 ~ woman_win, data = constituency_data)
mod2007_fem4 <- lm(v744d_f2007 ~ woman_win, data = constituency_data)
mod2007_fem5 <- lm(v744e_f2007 ~ woman_win, data = constituency_data)
mod2007_fem7 <- lm(add_index_f2007 ~ woman_win, data = constituency_data)

observations <- c(nobs(mod2007_fem1),nobs(mod2007_fem2),nobs(mod2007_fem3),
                  nobs(mod2007_fem4),nobs(mod2007_fem5),nobs(mod2007_fem7))


mod2007_fem1 <- coeftest(mod2007_fem1, vcov=vcovHC(mod2007_fem1,type="HC0"))
mod2007_fem2 <- coeftest(mod2007_fem2, vcov=vcovHC(mod2007_fem2,type="HC0"))
mod2007_fem3 <- coeftest(mod2007_fem3, vcov=vcovHC(mod2007_fem3,type="HC0"))
mod2007_fem4 <- coeftest(mod2007_fem4, vcov=vcovHC(mod2007_fem4,type="HC0"))
mod2007_fem5 <- coeftest(mod2007_fem5, vcov=vcovHC(mod2007_fem5,type="HC0"))
mod2007_fem7 <- coeftest(mod2007_fem7, vcov=vcovHC(mod2007_fem7,type="HC0"))


#These models are specific to males

mod2007_mal1 <- lm(v744a_m2007 ~ woman_win, data = constituency_data)
mod2007_mal2 <- lm(v744b_m2007 ~ woman_win, data = constituency_data)
mod2007_mal3 <- lm(v744c_m2007 ~ woman_win, data = constituency_data)
mod2007_mal4 <- lm(v744d_m2007 ~ woman_win, data = constituency_data)
mod2007_mal5 <- lm(v744e_m2007 ~ woman_win, data = constituency_data)
mod2007_mal7 <- lm(add_index_m2007 ~ woman_win, data = constituency_data)

observations_male <- c(nobs(mod2007_mal1),nobs(mod2007_mal2),nobs(mod2007_mal3),
                       nobs(mod2007_mal4),nobs(mod2007_mal5),nobs(mod2007_mal7))


mod2007_mal1 <- coeftest(mod2007_mal1, vcov=vcovHC(mod2007_mal1,type="HC0"))
mod2007_mal2 <- coeftest(mod2007_mal2, vcov=vcovHC(mod2007_mal2,type="HC0"))
mod2007_mal3 <- coeftest(mod2007_mal3, vcov=vcovHC(mod2007_mal3,type="HC0"))
mod2007_mal4 <- coeftest(mod2007_mal4, vcov=vcovHC(mod2007_mal4,type="HC0"))
mod2007_mal5 <- coeftest(mod2007_mal5, vcov=vcovHC(mod2007_mal5,type="HC0"))
mod2007_mal7 <- coeftest(mod2007_mal7, vcov=vcovHC(mod2007_mal7,type="HC0"))


table_3a <- list(mod2007_fem1, mod2007_mal1, mod2007_fem2, mod2007_mal2, mod2007_fem3, mod2007_mal3, 
              mod2007_fem4, mod2007_mal4, mod2007_fem5, mod2007_mal5)

note_text <- paste(" Beta coefficients from OLS regression. Decimals rounded to two digits to maintain alignment. Standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one's wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

#I named this next table 3a1 because it seemts like its using the moedels from table 3a

table_3a1 = stargazer(table,
                  title = "Effect of Female Incumbency on Pre-treatment Attitudes Towards IPV (Placebo Test)",
                  label = 'tab:placebo',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.separate = c(2,2,2,2,2,2),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", rep(observations, 2)),
                                   c('Bandwidth', rep(c('1\\%'), 12)),
                                   c("Gender", rep(c("F", "M"), 6))),
                  covariate.labels = c("Female"),
                  star.cutoffs = c(0.05, 0.01),
                  digits = 3,
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l')


table_3b <- list(mod2007_fem1, mod2007_mal1, mod2007_fem2, mod2007_mal2, mod2007_fem3, mod2007_mal3, 
              mod2007_fem4, mod2007_mal4, mod2007_fem5, mod2007_mal5, mod2007_fem7, mod2007_mal7)

note_text <- paste(" Beta coefficients from OLS regression. Decimals rounded to two digits to maintain alignment. Heteroskedastic consistent standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one's wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

#This next table is using information from the table above

table_3b1 = stargazer(table,
                  title = "Effect of Female Incumbency on Pre-treatment Female Support for IPV (Placebo Test)",
                  label = 'tab:placebo_full',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.separate = c(2,2,2,2,2,2),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", rep(observations, 2)),
                                   c('Bandwidth', rep(c('1\\%'), 12)),
                                   c("Gender", rep(c("F", "M"), 6))),
                  covariate.labels = c("Female"),
                  star.cutoffs = c(0.05, 0.01),
                  digits = 3,
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l')

#Table_a3
#Looks at dependent variables for both males and females 

#note_text <- paste("")



table_a3 = stargazer(constituency_data, 
                  title = "Descriptive Statistics (Female Respondent Outcomes)",
                  label = 'tab:dso',
                  summary = T,
                  keep = c(7, 8, 9, 10, 11, 12),
                  covariate.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Additive index")
                  )

#I took out this write latex part bc my latex doesn't work
#write_latex_plain(table, note_text, './outputs/tables/descriptives_outcomes.tex')

#note_text <- paste("")


table_a3_2 = stargazer(constituency_data,
                  title = "Descriptive Statistics (Male Respondent Outcomes)",
                  label = 'tab:dso_male',
                  summary = T,
                  keep = c(25, 26, 27, 28, 29, 30),
                  covariate.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Additive index")
)

```

#Tables and Figures:

```{r,tables and figures,results="asis"}
# Replication code for table 1

# This next line of code filters for the constitutency data so we only look at regions where females win by a margin of 1 percent or less


# This filtering will be used by all the models and tables throughout the paper

constituency_data <- constituency_data[abs(constituency_data$win_margin) < 0.01,]




#These fitted lines model the relationship between female incumbency and public opinions on 5 questions. These five questions incude 1)Is it okay to beat one's wife if she goes out?  2)Is it okay to beat one's wife if she neglects the kids?  3)Is it okay to beat one's wife if she argues? 4)Is it okay to beat one's wife if she refuses food ? 5) Is it okay to beat one's wife if she burns food?

mod_fem1 <- lm(v744a_f2012 ~ woman_win, data = constituency_data)
mod_fem2 <- lm(v744b_f2012 ~ woman_win, data = constituency_data)
mod_fem3 <- lm(v744c_f2012 ~ woman_win, data = constituency_data)
mod_fem4 <- lm(v744d_f2012 ~ woman_win, data = constituency_data)
mod_fem5 <- lm(v744e_f2012 ~ woman_win, data = constituency_data)

#This added an index of the prior information onto the table

mod_fem7 <- lm(add_index_f2012 ~ woman_win, data = constituency_data)

#Nobs computes the number of non-missing observations

observations <- c(nobs(mod_fem1),nobs(mod_fem2),nobs(mod_fem3),nobs(mod_fem4),nobs(mod_fem5),nobs(mod_fem7))

#Coefests is an inference for estimated coefficents on the models

mod_fem1 <- coeftest(mod_fem1, vcov=vcovHC(mod_fem1,type="HC0"))
mod_fem2 <- coeftest(mod_fem2, vcov=vcovHC(mod_fem2,type="HC0"))
mod_fem3 <- coeftest(mod_fem3, vcov=vcovHC(mod_fem3,type="HC0"))
mod_fem4 <- coeftest(mod_fem4, vcov=vcovHC(mod_fem4,type="HC0"))
mod_fem5 <- coeftest(mod_fem5, vcov=vcovHC(mod_fem5,type="HC0"))
mod_fem7 <- coeftest(mod_fem7, vcov=vcovHC(mod_fem7,type="HC0"))

#Made the models with their respective coefficents into a table 

table <- list(mod_fem1, mod_fem2, mod_fem3, mod_fem4, mod_fem5, mod_fem7)

note_text <- paste("Beta coefficients from OLS regression. Standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one's wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

#Used stargazer to make the table

table = stargazer(table,
                  title = "Effect of Female Incumbency on Female Attitudes Towards IPV", 
                  label = 'tab:table_female',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", observations),
                                   c('Bandwidth', rep(c('1\\%'), 6))),
                  covariate.labels = c("Female Incumbency"),
                  star.cutoffs = c(0.05, 0.01),
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l')


#Reading in table 2 

#These lines of code do the same thing that the previous table did, however, rather than predicting female respondent results, it predicts male respondent results. 

mod_mal1 <- lm(v744a_m2012 ~ woman_win, data = constituency_data)
mod_mal2 <- lm(v744b_m2012 ~ woman_win, data = constituency_data)
mod_mal3 <- lm(v744c_m2012 ~ woman_win, data = constituency_data)
mod_mal4 <- lm(v744d_m2012 ~ woman_win, data = constituency_data)
mod_mal5 <- lm(v744e_m2012 ~ woman_win, data = constituency_data)
mod_mal7 <- lm(add_index_m2012 ~ woman_win, data = constituency_data)

observations <- c(nobs(mod_mal1),nobs(mod_mal2),nobs(mod_mal3),nobs(mod_mal4),nobs(mod_mal5),nobs(mod_mal7))

mod_mal1 <- coeftest(mod_mal1, vcov=vcovHC(mod_mal1,type="HC0"))
mod_mal2 <- coeftest(mod_mal2, vcov=vcovHC(mod_mal2,type="HC0"))
mod_mal3 <- coeftest(mod_mal3, vcov=vcovHC(mod_mal3,type="HC0"))
mod_mal4 <- coeftest(mod_mal4, vcov=vcovHC(mod_mal4,type="HC0"))
mod_mal5 <- coeftest(mod_mal5, vcov=vcovHC(mod_mal5,type="HC0"))
mod_mal7 <- coeftest(mod_mal7, vcov=vcovHC(mod_mal7,type="HC0"))

table <- list(mod_mal1, mod_mal2, mod_mal3, mod_mal4, mod_mal5, mod_mal7)

note_text <- paste("Beta coefficients from OLS regression. Standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one’s wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

table2 = stargazer(table,
                  title = "Effect of Female Incumbency on Male Attitudes Towards IPV",
                  label = 'tab:table_male',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", observations),
                                   c('Bandwidth', rep(c('1\\%'), 6))),
                  covariate.labels = c("Female Incumbency"),
                  star.cutoffs = c(0.05, 0.01),
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l')


# Reading in table 3

# This table runs the hypothetical placebo effect for both males and females of the models prior

#These models are specific to females

mod2007_fem1 <- lm(v744a_f2007 ~ woman_win, data = constituency_data)
mod2007_fem2 <- lm(v744b_f2007 ~ woman_win, data = constituency_data)
mod2007_fem3 <- lm(v744c_f2007 ~ woman_win, data = constituency_data)
mod2007_fem4 <- lm(v744d_f2007 ~ woman_win, data = constituency_data)
mod2007_fem5 <- lm(v744e_f2007 ~ woman_win, data = constituency_data)
mod2007_fem7 <- lm(add_index_f2007 ~ woman_win, data = constituency_data)

observations <- c(nobs(mod2007_fem1),nobs(mod2007_fem2),nobs(mod2007_fem3),
                  nobs(mod2007_fem4),nobs(mod2007_fem5),nobs(mod2007_fem7))


mod2007_fem1 <- coeftest(mod2007_fem1, vcov=vcovHC(mod2007_fem1,type="HC0"))
mod2007_fem2 <- coeftest(mod2007_fem2, vcov=vcovHC(mod2007_fem2,type="HC0"))
mod2007_fem3 <- coeftest(mod2007_fem3, vcov=vcovHC(mod2007_fem3,type="HC0"))
mod2007_fem4 <- coeftest(mod2007_fem4, vcov=vcovHC(mod2007_fem4,type="HC0"))
mod2007_fem5 <- coeftest(mod2007_fem5, vcov=vcovHC(mod2007_fem5,type="HC0"))
mod2007_fem7 <- coeftest(mod2007_fem7, vcov=vcovHC(mod2007_fem7,type="HC0"))


# These models are specific to males

mod2007_mal1 <- lm(v744a_m2007 ~ woman_win, data = constituency_data)
mod2007_mal2 <- lm(v744b_m2007 ~ woman_win, data = constituency_data)
mod2007_mal3 <- lm(v744c_m2007 ~ woman_win, data = constituency_data)
mod2007_mal4 <- lm(v744d_m2007 ~ woman_win, data = constituency_data)
mod2007_mal5 <- lm(v744e_m2007 ~ woman_win, data = constituency_data)
mod2007_mal7 <- lm(add_index_m2007 ~ woman_win, data = constituency_data)

observations_male <- c(nobs(mod2007_mal1),nobs(mod2007_mal2),nobs(mod2007_mal3),
                       nobs(mod2007_mal4),nobs(mod2007_mal5),nobs(mod2007_mal7))


mod2007_mal1 <- coeftest(mod2007_mal1, vcov=vcovHC(mod2007_mal1,type="HC0"))
mod2007_mal2 <- coeftest(mod2007_mal2, vcov=vcovHC(mod2007_mal2,type="HC0"))
mod2007_mal3 <- coeftest(mod2007_mal3, vcov=vcovHC(mod2007_mal3,type="HC0"))
mod2007_mal4 <- coeftest(mod2007_mal4, vcov=vcovHC(mod2007_mal4,type="HC0"))
mod2007_mal5 <- coeftest(mod2007_mal5, vcov=vcovHC(mod2007_mal5,type="HC0"))
mod2007_mal7 <- coeftest(mod2007_mal7, vcov=vcovHC(mod2007_mal7,type="HC0"))


table_3a <- list(mod2007_fem1, mod2007_mal1, mod2007_fem2, mod2007_mal2, mod2007_fem3, mod2007_mal3, 
              mod2007_fem4, mod2007_mal4, mod2007_fem5, mod2007_mal5)

note_text <- paste(" Beta coefficients from OLS regression. Decimals rounded to two digits to maintain alignment. Standard errors were calculated using the huber-white (HC0) correction. The outcomes are drawn from a battery of questions that asked respondents if it was acceptable to beat one's wife if she: (1) goes out without telling her husband; (2) neglects her children; (3) argues with her husband; (4) refuses sex; (5) burns the food. The index is an additive measure.")

# I named this next table 3a1 because it seemts like its using the moedels from table 3a

table_3a1 = stargazer(table,
                  title = "Effect of Female Incumbency on Pre-treatment Attitudes Towards IPV (Placebo Test)",
                  label = 'tab:placebo',
                  model.names = F,
                  model.numbers = T,
                  #column.separate = c(6),
                  column.separate = c(2,2,2,2,2,2),
                  column.labels = c("Goes out", "Neglects children", "Argues", "Refuses sex", "Burns food", "Index"),
                  
                  multicolumn = T,
                  dep.var.labels = c("Is it okay to beat one's wife if she:"), 
                  add.lines = list(c("Observations", rep(observations, 2)),
                                   c('Bandwidth', rep(c('1\\%'), 12)),
                                   c("Gender", rep(c("F", "M"), 6))),
                  covariate.labels = c("Female"),
                  star.cutoffs = c(0.05, 0.01),
                  digits = 3,
                  #float.env = 'sidewaystable',
                  keep.stat = c("n"),
                  notes = NULL,
                  notes.align = 'l') 

# Reading in Figure B.1
# Share of Seats Won by Women in Treatment and Control Constituencies

# Comment from the actual Paper( "make the first stage graph")
# Mutating the variables from the gender dataset
# Using the data set name gender_estimation_data instead of estimatuon_data (which is what the author originally had) because that is how it's named in my library 

gender_estimation_data$gender <- as.numeric(as.character(gender_estimation_data $gender))
gender_estimation_data$woman_win <- as.numeric(as.character(gender_estimation_data $woman_win))

# Grouping by the dapil code
# Calculating the mean of the percentages of woman winning by dapil code
# I'm assuming that by making gender=0, we are nly accounting for females that are denoted by the binary variable 0

tdat <- gender_estimation_data %>% 
  group_by(dapil_code) %>% 
  summarise(mean(woman_win, na.rm=T),
                           mean(gender == 0, na.rm=T))

# Plotting the data for both the control, pre election of a female legislator, and the treatment, election of a female legislator 

plot_dat <- tdat %>% filter (`mean(woman_win, na.rm = T)` == 1 | `mean(woman_win, na.rm = T)` == 0) %>% 
  group_by(`mean(woman_win, na.rm = T)`) %>% summarise(mean(`mean(gender == 0, na.rm = T)`))

# Naming the plot

names(plot_dat) <- c("woman_win", "prop")

#plot_dat$woman_win <- mutate(plot_dat$woman_win == as.character(plot_dat$woman_win))

# Naming the x axis 

plot_dat <- plot_dat %>% mutate(woman_win =ifelse(woman_win == 1, "Treatment", "Control"))
  

#plot_dat <- mutate(plot_dat$woman_win ==ifelse(plot_dat$woman_win = "1", "Treatment", "Control"))
  
  
plot_dat[plot_dat$woman_win == 1,]$woman_win <- "Treatment"
plot_dat[plot_dat$woman_win == 0,]$woman_win <- "Control"

plot_dat[plot_dat$woman_win == 1,]$woman_win <- "Treatment"
plot_dat[plot_dat$woman_win == 0,]$woman_win <- "Control"

# Creating the graphic and looking at the porportions of seats held by women before and after 2009

p10 <- ggplot(plot_dat, aes(x=as.factor(woman_win), y = prop)) + geom_bar(stat = "identity", fill = "darkgrey", color = "black") + theme_minimal() + ylab("Share of Seats Held by Women") +
  xlab("") + theme(text=element_text(size=10, family="Times")) + labs(title= " Share of Seats Won by Women in Treatment and Control Constituencies")


# Printing the table

p10
 




```

